# .github/workflows/reusable-review.yml
on:
  workflow_call:
    inputs:
      dry_run:
        description: "Run without posting comments"
        type: boolean
        default: false
      max_comments:
        description: "Max inline comments"
        type: number
        default: 20
      severity:
        description: "Minimum severity (info, warn, error)"
        type: string
        default: "info"
    secrets:
      token:                    # ← FIXED: was "github_token"
        required: true
      client_id:
        required: false
      client_secret:
        required: false

# ... rest of the file ...

jobs:
  review:
    name: AI Code Review (Agentic)
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      # ... steps ...

      - name: Run Agentic AI Review
        env:
          GITHUB_TOKEN: ${{ secrets.token }}    # ← FIXED: was secrets.github_token
          GITHUB_REPOSITORY: ${{ github.repository }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          AI_REVIEW_MAX_COMMENTS: ${{ inputs.max_comments }}
          AI_REVIEW_SEVERITY: ${{ inputs.severity }}
          AI_REVIEW_DRY_RUN: ${{ inputs.dry_run }}
          PYTHONPATH: .ai-reviewer-tool
        run: |
          python .ai-pr-reviewer/runner.py \
            --repo "$GITHUB_REPOSITORY" \
            --pr "$PR_NUMBER" \
            --config .ai-reviewer.json \
            --policy .ai-pr-reviewer/configs/agent_policy.json \
            --templates .ai-pr-reviewer/policies/prompt_templates.json
